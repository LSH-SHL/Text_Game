<!DOCTYPE html>
<html lang = "ko">

<head>
<!-- charset는 문자 유니코드 방식 설정 name 부분은 우리가 창을 조절하면 그 창에 맞게 조정하는 역할을 하는 코드-->
<!-- http-equiv는 HTTP의 헤더를 제공 받는다는데 잘은 모르겠음 title은 알다싶이 탭의 이름을 설정하는 부분-->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge"> 
  <link rel="stylesheet" href="css/InitialPageStyle.css">
  <title>TEXT RPG</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src= "https://script.google.com/macros/s/AKfycby-ze05RZPGafy9WF8kwCwfAAiWBhxr0j_3Nf3t8GnztnLdQZq4D6z-PywJPLc8Uvsq/exec"></script>
  Access-Control-Allow-Origin: https://lsh-shl.github.io
</head>

<script type="text/javascript">
function onNewIDbox()
{
    var now = document.getElementById("NewGame");
    if (now.style.display == 'none'){
        now.style.display='block';
	document.getElementById("google-submit").style.display='block';
    }else{
        now.style.display='none';
	document.getElementById("google-submit").style.display='none';    
    }
}	
function onIDbox()
{
    var now = document.getElementById("ContinueGame");
    if (now.style.display == 'none'){
        now.style.display='block';
	document.getElementById("google-submit").style.display='block';
	document.getElementById("id").style.display='block';
    }else{
        now.style.display='none';
	document.getElementById("google-submit").style.display='none';
	document.getElementById("id").style.display='none';
    }	
}
		
</script>	
	
<body bgcolor="black">
    <div class="title">GAME</div>
    <button type="button" onclick="onNewIDbox()">시작하기</button>
    <div id="NewGame" style="display: none;">
	    <p style="color:white;">새로 생성할 ID를 적어주세요.</p>
    	    <input type="text" id="NewID" name="ID"><br>
	    <button type="button" id="google-submit" onclick="GoogleScript()" style="width:100pt;height:40pt"></button>
    </div>
    <br><br><br>
    <button type="button" onclick="onIDbox()">이어하기</button>
    <div id="ContinueGame" style="display: none;">
	    <p style="color:white;">ID를 입력해주세요.</p>
    	    <input type="text" name="ID" placeholder="생성할 ID입력"><br>
	    <button id="google-submit" style="width:100pt;height:40pt">로그인</button>
    </div>
    <div id="snackbar"></div>
</body>

<script type="text/javascript">

function GoogleScript()
{
  var Console = document.getElementById("NewID").value;
  ConsoleDATA();
  console.log(Console);
  var Value = ajaxReturnDATA(Console);
  if (Value == 1)
  {
      $.ajax({
      url: "https://script.google.com/macros/s/AKfycbyI2qcgqnxd1lXbD4uKdfOpQTCmynjFAfqKqPXWnWjCymg5Ps3YigqFfrmofaq22X3Y8A/exec",
      data: {ID:Console},
      type: "POST"
      });
      alert("아이디 생성이 완료되었습니다.");
  }
  else
  {
      alert("해당 아이디는 이용 중입니다.");
  }
}	
function ConsoleDATA()
{
    var GSSurl = "https://spreadsheets.google.com/feeds/list/1mAh5qXzA5oTbe0HC7EznSr9C6nnkO54AlUo2cDJKiPY/1/public/basic?alt=json-in-script&callback=?";

    $.getJSON(GSSurl,function(data){
    
    	var entry=data.feed.entry;//구글 스프레드 시트의 모든 내용은 feed.entry에 담겨있습니다.
    
    	for(var i in entry){ // 각 행에대해 아래 스크립트를 실행합니다.
    
    		$("body").append(entry[i].title.$t);// .title.$t 에는 1행의 내용이 들어있습니다.
    
    		$("body").append(entry[i].content.$t);// .content.$t 에는 나머지행의 데이터가 header정보와 함께 들어있습니다.
    
    	} 
    
    });

}

	
	
function convertToCorsUrl(url){

var protocol = (window.location.protocol === 'http:' ? 'http:' : 'https:');
console.log("Convert10");
return protocol + '//cors-anywhere.herokuapp.com/' + url;

}
	
	
function ajaxReturnDATA(Console)
{
    var Result;
    var URL = "https://script.google.com/macros/s/AKfycby-ze05RZPGafy9WF8kwCwfAAiWBhxr0j_3Nf3t8GnztnLdQZq4D6z-PywJPLc8Uvsq/exec";
    URL = convertToCorsUrl(URL);
    console.log(URL);
    $.ajax({
        type : "post"
	,contentType: "application/x-www-form-urlencoded; charset=UTF-8"
        ,url : URL
        ,data : Console
	,dataType : "json"
        ,async : false
        ,success: function myFunction(Console){
	    console.log("초코케잌");
            Result = Console;
        }
    });
    console.log("Success!!");
    console.log(parseInt(Result));
    return parseInt(Result);
}
	
</script>

</html>



