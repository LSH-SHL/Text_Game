<!DOCTYPE html>
<html lang = "ko">

<head>
<!-- charset는 문자 유니코드 방식 설정 name 부분은 우리가 창을 조절하면 그 창에 맞게 조정하는 역할을 하는 코드-->
<!-- http-equiv는 HTTP의 헤더를 제공 받는다는데 잘은 모르겠음 title은 알다싶이 탭의 이름을 설정하는 부분-->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge"> 
  <link rel="stylesheet" href="css/InitialPageStyle.css">
  <title>TEXT RPG</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
</head>

<script type="text/javascript">
function onNewIDbox()
{
    var now = document.getElementById("NewGame");
    if (now.style.display == 'none'){
        now.style.display='block';
	document.getElementById("google-submit").style.display='block';
    }else{
        now.style.display='none';
	document.getElementById("google-submit").style.display='none';    
    }
}	
function onIDbox()
{
    var now = document.getElementById("ContinueGame");
    if (now.style.display == 'none'){
        now.style.display='block';
	document.getElementById("google-submit").style.display='block';
	document.getElementById("id").style.display='block';
    }else{
        now.style.display='none';
	document.getElementById("google-submit").style.display='none';
	document.getElementById("id").style.display='none';
    }	
}
		
</script>	
	
<body bgcolor="black">
    <div class="title">GAME</div>
    <button type="button" onclick="onNewIDbox()">시작하기</button>
    <div id="NewGame" style="display: none;">
	    <p style="color:white;">새로 생성할 ID를 적어주세요.</p>
    	    <input type="text" id="NewID" name="ID"><br>
	    <button type="button" id="google-submit" onclick="GoogleScript()" style="width:100pt;height:40pt"></button>
    </div>
    <br><br><br>
    <button type="button" onclick="onIDbox()">이어하기</button>
    <div id="ContinueGame" style="display: none;">
	    <p style="color:white;">ID를 입력해주세요.</p>
    	    <input type="text" name="ID" placeholder="생성할 ID입력"><br>
	    <button id="google-submit" style="width:100pt;height:40pt">로그인</button>
    </div>
    <div id="snackbar"></div>
</body>

<script type="text/javascript">
window.addEventListener('DOMContentLoaded', main);

function GoogleScript()
{
  var Console = document.getElementById("NewID").value;
  if (Discrimination() == 1)
  {
      $.ajax({
      url: "https://script.google.com/macros/s/AKfycbyI2qcgqnxd1lXbD4uKdfOpQTCmynjFAfqKqPXWnWjCymg5Ps3YigqFfrmofaq22X3Y8A/exec",
      data: {ID:Console},
      type: "POST"
      });
      alert("아이디 생성이 완료되었습니다.");
  }
  else
  {
      alert("해당 아이디는 이용 중입니다.");
  }
}	

async function Discrimination(){
    const NEWID = document.getElementsById('NewID');
    consloe.log(NEWID);
	const SOURCE = 'https://spreadsheets.google.com/feeds/list/1mAh5qXzA5oTbe0HC7EznSr9C6nnkO54AlUo2cDJKiPY/1/public/full?alt=json';
	const COLUMNS = ['ID', 'Nickname', 'Level', 'Experience', 'Money', 'HP', 'MP', 'FP', 'Attack', 'Defense', 'Dodge', 'CriticalDamage', 'Critical', 'BossDamage'];
	
	const DATA = await separateRowFromJson(SOURCE, COLUMNS);
    for (let i = 0; i < DATA.length;i++)
    {
        if (NEWID == DATA[i]['ID'])
        {
            return 0;
        }
    }
    return 1;
}

async function separateRowFromJson(SOURCE, COLUMNS){
	const FETCHED_SOURCE = await fetch(SOURCE);
  	let temp = await FETCHED_SOURCE.json();
 	temp = temp['feed']['entry'];

	let _DATA = [];
	for(var i=0; i<Object.keys(temp).length; i++){
		_DATA[i]={};
		for(var k=0; k<Object.keys(COLUMNS).length; k++){;
			_DATA[i][COLUMNS[k]] = temp[i]['gsx$'+COLUMNS[k]]['$t'];
		}
	}
	
	return _DATA;
}		
</script>

</html>
